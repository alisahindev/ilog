---
description: 
globs: 
alwaysApply: true
---
ğŸ§± MDC Belgesi: ilog
ğŸ¯ AmaÃ§ (Purpose)
Bu modÃ¼l, JavaScript/TypeScript projelerinde kullanÄ±lmak Ã¼zere, Ã¶zelleÅŸtirilebilir, geniÅŸletilebilir ve kurumsal ihtiyaÃ§lara uygun bir loglama altyapÄ±sÄ± sunmayÄ± amaÃ§lar. AmacÄ±mÄ±z sadece bilgi yazmak deÄŸil, aynÄ± zamanda aÅŸaÄŸÄ±daki yetenekleri saÄŸlamaktÄ±r:

Ortak bir logging interface (API) sunmak

Kendi business contextâ€™lerini loglara entegre edebilmek

FarklÄ± ortam (dev, test, prod) yapÄ±landÄ±rmalarÄ±na gÃ¶re davranÄ±ÅŸ deÄŸiÅŸtirebilmek

JSON formatÄ±nda structured log Ã§Ä±ktÄ±sÄ± Ã¼retmek

Async transport'lar (Ã¶r. logstash, Sentry, Datadog) entegre edilebilmek

Class ve context bazlÄ± log oluÅŸturulabilmek

ğŸ§± Mimari YapÄ± (Architecture Overview)
plaintext
Copy
Edit
@yourorg/logger
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ Logger.ts             â†’ Ana logger classâ€™Ä±
â”‚   â”œâ”€â”€ LogLevel.ts           â†’ Log seviyeleri enum
â”‚   â”œâ”€â”€ LogFormatter.ts       â†’ Log mesajlarÄ±nÄ± formatlayan sÄ±nÄ±f
â”‚   â””â”€â”€ LogTransport.ts       â†’ Abstract transport interface
â”‚
â”œâ”€â”€ transports/
â”‚   â”œâ”€â”€ ConsoleTransport.ts   â†’ console.log wrapper
â”‚   â”œâ”€â”€ FileTransport.ts      â†’ opsiyonel dosya loglayÄ±cÄ±
â”‚   â””â”€â”€ RemoteTransport.ts    â†’ external log servislerine gÃ¶nderim (opsiyonel)
â”‚
â”œâ”€â”€ context/
â”‚   â”œâ”€â”€ LogContext.ts         â†’ Request ID, user ID, vs gibi context
â”‚   â””â”€â”€ ContextManager.ts     â†’ AsyncLocalStorage ile context yÃ¶netimi
â”‚
â”œâ”€â”€ decorators/
â”‚   â””â”€â”€ LogMethod.ts          â†’ method log decoratorâ€™Ä±
â”‚
â”œâ”€â”€ index.ts                  â†’ public API giriÅŸi
â””â”€â”€ types/
    â””â”€â”€ index.d.ts            â†’ global type tanÄ±mlamalarÄ±
    
ğŸ“¦ KullanÄ±lan Teknolojiler
TypeScript: %100 tip gÃ¼venliÄŸi

AsyncLocalStorage: Context tracking iÃ§in

ESM/CJS uyumluluÄŸu: Hem Node hem modern bundler desteÄŸi

Functional + OOP yapÄ±: Hem class hem functional kullanÄ±m mÃ¼mkÃ¼n

ğŸ”§ ModÃ¼l DetaylarÄ±
1. Logger (core/Logger.ts)
ts
Copy
Edit
export class Logger {
  constructor(private options: LoggerOptions);

  info(message: string, meta?: Meta): void;
  warn(message: string, meta?: Meta): void;
  error(message: string, meta?: Meta): void;
  debug(message: string, meta?: Meta): void;

  setContext(context: LogContext): void;
  addTransport(transport: LogTransport): void;
}
2. LogLevel (core/LogLevel.ts)
ts
Copy
Edit
export enum LogLevel {
  DEBUG = 'debug',
  INFO = 'info',
  WARN = 'warn',
  ERROR = 'error',
}
3. LogFormatter (core/LogFormatter.ts)
ts
Copy
Edit
export class LogFormatter {
  static format(level: LogLevel, message: string, meta?: Meta): string;
}
4. LogTransport (core/LogTransport.ts)
ts
Copy
Edit
export interface LogTransport {
  log(level: LogLevel, message: string, context?: LogContext, meta?: Meta): void;
}
5. LogContext & ContextManager
ts
Copy
Edit
export type LogContext = {
  requestId?: string;
  userId?: string;
  businessUnit?: string;
};

export class ContextManager {
  static runWith<T>(context: LogContext, fn: () => T): T;
  static getContext(): LogContext;
}
6. @LogMethod (decorators/LogMethod.ts)
ts
Copy
Edit
export function LogMethod(): MethodDecorator;
KullanÄ±mÄ±:

ts
Copy
Edit
class MyService {
  @LogMethod()
  processOrder() {
    // otomatik log
  }
}
âœ… Ã–rnek KullanÄ±m
ts
Copy
Edit
import { Logger, LogLevel, ConsoleTransport, ContextManager } from '@yourorg/logger';

const logger = new Logger({ level: LogLevel.DEBUG });
logger.addTransport(new ConsoleTransport());

ContextManager.runWith({ requestId: 'abc-123', userId: 'user-456' }, () => {
  logger.info('User logged in');
  someBusinessLogic();
});
ğŸ§ª Test PlanÄ±
 TÃ¼m log seviyeleri test edilecek

 Context isolation (aynÄ± anda farklÄ± async iÅŸlemler)

 Transport fallback'larÄ±

 JSON format validasyonu

 Typing coverage (tsc --noEmit + strict)

ğŸ“ YayÄ±nlama
npm package: @yourorg/logger

Typescript types: types dizininden otomatik export

ESM + CJS: Rollup ile iki ayrÄ± bundle

README + Usage Examples: Dev dokÃ¼mantasyonu

ğŸš€ Gelecek GeniÅŸletmeler (Future Enhancements)
 Log throttling (burst engelleme)

 Log sampling (Ã¶r. %10 debug log)

 OpenTelemetry integration

 JSON Schema validasyonlu structured meta

ğŸ“Œ Notlar
AsyncLocalStorage, yalnÄ±zca Node.js 14+ sÃ¼rÃ¼mlerde stabil. Eski sÃ¼rÃ¼mler iÃ§in fallback gerekebilir.

Transportâ€™lar async yapÄ±labilir fakat Logger class sync kalmalÄ± (performans ve kontrol aÃ§Ä±sÄ±ndan).

